# å­è·¯å¾„éƒ¨ç½²é…ç½®è¯´æ˜

## âœ… å½“å‰é…ç½®

ä½ çš„æœåŠ¡å·²é…ç½®ä¸ºå­è·¯å¾„éƒ¨ç½²ï¼š`/nsrlchat/`

## ğŸ“ è®¿é—®åœ°å€

æ‰€æœ‰è®¿é—®åœ°å€éƒ½éœ€è¦åŒ…å« `/nsrlchat/` å‰ç¼€ï¼š

- **ä¸»åº”ç”¨**ï¼š`https://nsrloa.ustc.edu.cn/nsrlchat/`
- **ç™»å½•é¡µ**ï¼š`https://nsrloa.ustc.edu.cn/nsrlchat/auth/login-page`
- **ç®¡ç†å‘˜é¡µ**ï¼š`https://nsrloa.ustc.edu.cn/nsrlchat/auth/admin`
- **ä¸Šä¼ é¡µ**ï¼š`https://nsrloa.ustc.edu.cn/nsrlchat/upload.html`
- **å¥åº·æ£€æŸ¥**ï¼š`https://nsrloa.ustc.edu.cn/nsrlchat/health`
- **Agent API**ï¼š`https://nsrloa.ustc.edu.cn/nsrlchat/agent/chat`
- **çŸ¥è¯†åº“API**ï¼š`https://nsrloa.ustc.edu.cn/nsrlchat/kb/api/...`

## ğŸ”§ nginxé…ç½®ç¤ºä¾‹

```nginx
server {
    listen 443 ssl;
    server_name nsrloa.ustc.edu.cn;

    # SSLè¯ä¹¦é…ç½®
    ssl_certificate /path/to/cert.pem;
    ssl_certificate_key /path/to/key.pem;

    # å­è·¯å¾„ä»£ç†é…ç½®
    location /nsrlchat/ {
        proxy_pass http://localhost:8000/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Forwarded-Prefix /nsrlchat;
        
        # WebSocketæ”¯æŒï¼ˆå¦‚æœéœ€è¦ï¼‰
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }
}
```

**é‡è¦æç¤ºï¼š**
- `proxy_pass` åé¢å¿…é¡»æœ‰ `/`ï¼Œè¿™æ ·ä¼šæ­£ç¡®è½¬å‘è·¯å¾„
- `proxy_set_header X-Forwarded-Prefix /nsrlchat;` ç”¨äºå‘Šè¯‰åº”ç”¨å½“å‰çš„å‰ç¼€

## ğŸš€ æœåŠ¡ç®¡ç†

### å¯åŠ¨æœåŠ¡

ä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰ï¼š
```bash
cd /home/user/ustcchat/ustc
./å¯åŠ¨è„šæœ¬_å­è·¯å¾„.sh
```

æˆ–æ‰‹åŠ¨å¯åŠ¨ï¼š
```bash
cd /home/user/ustcchat/ustc
export ROOT_PATH="/nsrlchat"
tmux new-session -d -s nsrlchat \
    "exec env ROOT_PATH=/nsrlchat /home/user/miniconda3/envs/langchain/bin/python web_memory.py"
```

### æŸ¥çœ‹æ—¥å¿—

```bash
# è¿æ¥åˆ°tmuxä¼šè¯æŸ¥çœ‹å®æ—¶æ—¥å¿—
tmux attach -t nsrlchat

# æŸ¥çœ‹ä¼šè¯è¾“å‡ºï¼ˆä¸è¿›å…¥ä¼šè¯ï¼‰
tmux capture-pane -t nsrlchat -p | tail -50
```

### åœæ­¢æœåŠ¡

```bash
# æ–¹æ³•1ï¼šåœ¨tmuxä¼šè¯ä¸­æŒ‰ Ctrl+C
tmux send-keys -t nsrlchat C-c

# æ–¹æ³•2ï¼šç›´æ¥æ€æ‰ä¼šè¯
tmux kill-session -t nsrlchat

# æ–¹æ³•3ï¼šæ€æ‰è¿›ç¨‹
pkill -f "python.*web_memory.py"
```

### é‡å¯æœåŠ¡

```bash
# åœæ­¢æœåŠ¡
tmux kill-session -t nsrlchat

# å¯åŠ¨æœåŠ¡
cd /home/user/ustcchat/ustc
./å¯åŠ¨è„šæœ¬_å­è·¯å¾„.sh
```

## âœ… éªŒè¯é…ç½®

### 1. æ£€æŸ¥ç¯å¢ƒå˜é‡

```bash
# åœ¨tmuxä¼šè¯ä¸­æ£€æŸ¥
tmux capture-pane -t nsrlchat -p | grep ROOT_PATH
```

### 2. æµ‹è¯•å¥åº·æ£€æŸ¥

```bash
# æœ¬åœ°æµ‹è¯•
curl http://localhost:8000/health

# é€šè¿‡nginxæµ‹è¯•
curl https://nsrloa.ustc.edu.cn/nsrlchat/health
```

### 3. æµ‹è¯•è·¯ç”±

```bash
# æµ‹è¯•æ ¹è·¯å¾„ï¼ˆåº”è¯¥é‡å®šå‘åˆ°ç™»å½•é¡µï¼‰
curl -L https://nsrloa.ustc.edu.cn/nsrlchat/

# æµ‹è¯•ç™»å½•é¡µ
curl https://nsrloa.ustc.edu.cn/nsrlchat/auth/login-page
```

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜1ï¼šè®¿é—®404é”™è¯¯

**åŸå› ï¼š** nginxé…ç½®ä¸æ­£ç¡®æˆ–ROOT_PATHæœªè®¾ç½®

**è§£å†³ï¼š**
1. æ£€æŸ¥nginxé…ç½®ä¸­çš„ `proxy_pass` æ˜¯å¦æœ‰ `/`
2. ç¡®è®¤æœåŠ¡å¯åŠ¨æ—¶è®¾ç½®äº† `ROOT_PATH=/nsrlchat`
3. æ£€æŸ¥nginxé”™è¯¯æ—¥å¿—ï¼š`tail -f /var/log/nginx/error.log`

### é—®é¢˜2ï¼šé™æ€èµ„æºåŠ è½½å¤±è´¥

**åŸå› ï¼š** é™æ€æ–‡ä»¶è·¯å¾„ä¸æ­£ç¡®

**è§£å†³ï¼š**
1. ç¡®ä¿å‰ç«¯ä»£ç ä¸­çš„ `getBasePath()` å‡½æ•°æ­£ç¡®è¿”å› `/nsrlchat`
2. æ£€æŸ¥é™æ€æ–‡ä»¶è·¯ç”±æ˜¯å¦æ­£ç¡®é…ç½®

### é—®é¢˜3ï¼šAPIè¯·æ±‚å¤±è´¥

**åŸå› ï¼š** APIè·¯å¾„å‰ç¼€ä¸æ­£ç¡®

**è§£å†³ï¼š**
1. ç¡®ä¿å‰ç«¯ä»£ç ä½¿ç”¨ `/nsrlchat/agent/...` å’Œ `/nsrlchat/kb/...`
2. æ£€æŸ¥CORSé…ç½®æ˜¯å¦æ­£ç¡®

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **ç¯å¢ƒå˜é‡**ï¼šæ¯æ¬¡å¯åŠ¨æœåŠ¡éƒ½éœ€è¦è®¾ç½® `ROOT_PATH=/nsrlchat`
2. **nginxé‡è½½**ï¼šä¿®æ”¹nginxé…ç½®åéœ€è¦é‡è½½ï¼š`sudo nginx -s reload`
3. **æ—¥å¿—ä½ç½®**ï¼šæœåŠ¡æ—¥å¿—åœ¨ `/home/user/ustcchat/ustc/logs/`
4. **æŒä¹…åŒ–**ï¼šæœåŠ¡åœ¨tmuxä¸­è¿è¡Œï¼Œå³ä½¿æ–­å¼€SSHè¿æ¥ä¹Ÿä¼šç»§ç»­è¿è¡Œ

## ğŸ”„ åˆ‡æ¢åˆ°æ ¹è·¯å¾„éƒ¨ç½²

å¦‚æœéœ€è¦åˆ‡æ¢åˆ°æ ¹è·¯å¾„éƒ¨ç½²ï¼ˆ`https://nsrloa.ustc.edu.cn/`ï¼‰ï¼š

1. åœæ­¢æœåŠ¡ï¼š`tmux kill-session -t nsrlchat`
2. **ä¸è®¾ç½®** `ROOT_PATH` ç¯å¢ƒå˜é‡
3. ä¿®æ”¹nginxé…ç½®ï¼Œå°† `location /nsrlchat/` æ”¹ä¸º `location /`
4. é‡å¯æœåŠ¡

