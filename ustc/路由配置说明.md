# 路由配置说明

## 当前配置

你的服务挂载在：`https://nsrloa.ustc.edu.cn/`

## 两种情况

### 情况1：挂载在根路径 `/`（推荐）

**nginx配置示例：**
```nginx
server {
    listen 443 ssl;
    server_name nsrloa.ustc.edu.cn;

    location / {
        proxy_pass http://localhost:8000/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

**应用配置：**
- ✅ **不需要设置** `ROOT_PATH` 环境变量
- 当前配置即可正常工作

**访问地址：**
- 主应用：`https://nsrloa.ustc.edu.cn/`
- 登录页：`https://nsrloa.ustc.edu.cn/auth/login-page`
- 上传页：`https://nsrloa.ustc.edu.cn/upload.html`
- 健康检查：`https://nsrloa.ustc.edu.cn/health`
- Agent API：`https://nsrloa.ustc.edu.cn/agent/chat`
- 知识库API：`https://nsrloa.ustc.edu.cn/kb/api/...`

### 情况2：挂载在子路径 `/nsrlchat/`

**nginx配置示例：**
```nginx
server {
    listen 443 ssl;
    server_name nsrloa.ustc.edu.cn;

    location /nsrlchat/ {
        proxy_pass http://localhost:8000/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Forwarded-Prefix /nsrlchat;
    }
}
```

**应用配置：**
- ✅ **需要设置** `ROOT_PATH=/nsrlchat` 环境变量

**设置方法：**
```bash
# 在启动脚本或环境变量中设置
export ROOT_PATH="/nsrlchat"

# 或者在tmux会话中设置
tmux send-keys -t nsrlchat "export ROOT_PATH='/nsrlchat'" Enter
```

**访问地址：**
- 主应用：`https://nsrloa.ustc.edu.cn/nsrlchat/`
- 登录页：`https://nsrloa.ustc.edu.cn/nsrlchat/auth/login-page`
- 上传页：`https://nsrloa.ustc.edu.cn/nsrlchat/upload.html`
- 健康检查：`https://nsrloa.ustc.edu.cn/nsrlchat/health`
- Agent API：`https://nsrloa.ustc.edu.cn/nsrlchat/agent/chat`
- 知识库API：`https://nsrloa.ustc.edu.cn/nsrlchat/kb/api/...`

## 当前路由列表

### 主要页面路由
- `GET /` - 主应用页面（需要认证）
- `GET /auth/login-page` - 登录页面
- `GET /auth/admin` - 管理员页面
- `GET /upload.html` - 文件上传页面（需要管理员权限）

### API路由
- `POST /agent/chat` - 对话接口
- `POST /agent/chat/stream` - 流式对话接口
- `GET /agent/sessions` - 获取会话列表
- `GET /agent/conversations/{user_id}` - 获取用户对话列表
- `GET /kb/api/knowledge-bases` - 获取知识库列表
- `POST /kb/api/upload-file` - 上传文件

### 工具路由
- `GET /health` - 健康检查
- `GET /ustc.svg` - USTC logo
- `GET /nsrlchat/ustc.svg` - USTC logo（子路径版本）

## 检查当前配置

```bash
# 检查环境变量
echo $ROOT_PATH

# 检查服务状态
curl http://localhost:8000/health

# 检查tmux会话
tmux list-sessions

# 查看服务日志
tmux capture-pane -t nsrlchat -p | tail -20
```

## 注意事项

1. **如果使用根路径部署**：不需要设置 `ROOT_PATH`
2. **如果使用子路径部署**：必须设置 `ROOT_PATH=/nsrlchat`
3. **nginx配置**：确保 `proxy_pass` 后面有 `/`，这样会正确转发路径
4. **重启服务**：修改 `ROOT_PATH` 后需要重启服务

## 快速测试

```bash
# 测试根路径部署
curl https://nsrloa.ustc.edu.cn/health

# 测试子路径部署
curl https://nsrloa.ustc.edu.cn/nsrlchat/health
```

