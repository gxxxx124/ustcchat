# USTC Chat - æ™ºèƒ½å¯¹è¯ç³»ç»Ÿ

ä¸€ä¸ªåŸºäº FastAPI å’Œ LangGraph çš„æ™ºèƒ½å¯¹è¯ç³»ç»Ÿï¼Œæ”¯æŒçŸ¥è¯†åº“ç®¡ç†ã€æ–‡æ¡£ä¸Šä¼ ã€å¤šè§’è‰²æƒé™ç®¡ç†ç­‰åŠŸèƒ½ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ¤– **æ™ºèƒ½å¯¹è¯**: åŸºäº LangGraph çš„å¤šè½®å¯¹è¯ç³»ç»Ÿ
- ğŸ“š **çŸ¥è¯†åº“ç®¡ç†**: æ”¯æŒ PDFã€Markdownã€Word ç­‰æ–‡æ¡£ä¸Šä¼ å’Œå‘é‡æ£€ç´¢
- ğŸ‘¥ **å¤šè§’è‰²æƒé™**: æ”¯æŒæ™®é€šç”¨æˆ·ã€çŸ¥è¯†åº“è´¡çŒ®è€…ã€ç®¡ç†å‘˜ä¸‰ç§è§’è‰²
- ğŸ” **å¤šç§è®¤è¯æ–¹å¼**: æ”¯æŒç”¨æˆ·åå¯†ç ç™»å½•ã€USTC OAuthã€NSRL CAS ç­‰
- ğŸ” **æ™ºèƒ½æ£€ç´¢**: åŸºäºå‘é‡æ•°æ®åº“çš„è¯­ä¹‰æ£€ç´¢
- ğŸ“„ **æ–‡æ¡£è§£æ**: æ”¯æŒ Markerã€OCR ç­‰å¤šç§æ–‡æ¡£è§£ææ–¹å¼

## æŠ€æœ¯æ ˆ

- **åç«¯æ¡†æ¶**: FastAPI
- **å¯¹è¯æ¡†æ¶**: LangGraph
- **å‘é‡æ•°æ®åº“**: Qdrant
- **å…³ç³»æ•°æ®åº“**: PostgreSQL
- **è®¤è¯**: JWT
- **æ–‡æ¡£è§£æ**: Marker, OCR

## é¡¹ç›®ç»“æ„

```
ustcchat/
â”œâ”€â”€ ustc/                    # ä¸»åº”ç”¨ä»£ç 
â”‚   â”œâ”€â”€ web_memory.py        # ä¸»åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ auth.py              # è®¤è¯æ¨¡å—
â”‚   â”œâ”€â”€ auth_routes.py       # è®¤è¯è·¯ç”±
â”‚   â”œâ”€â”€ web_api.py           # API è·¯ç”±
â”‚   â”œâ”€â”€ rag_tool.py          # RAG å·¥å…·
â”‚   â”œâ”€â”€ pdf.py               # PDF å¤„ç†
â”‚   â”œâ”€â”€ chunks2embedding.py  # å‘é‡åŒ–
â”‚   â””â”€â”€ static/              # å‰ç«¯é™æ€æ–‡ä»¶
â”œâ”€â”€ requirements.txt         # Python ä¾èµ–
â”œâ”€â”€ .gitignore              # Git å¿½ç•¥æ–‡ä»¶
â””â”€â”€ README.md               # é¡¹ç›®è¯´æ˜
```

## å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒè¦æ±‚

- Python 3.10+
- PostgreSQL
- Qdrant
- CUDA (å¯é€‰ï¼Œç”¨äº GPU åŠ é€Ÿ)

### 2. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

### 3. é…ç½®ç¯å¢ƒå˜é‡

å¤åˆ¶ `.env.example` ä¸º `.env` å¹¶å¡«å†™é…ç½®ï¼š

```bash
cp .env.example .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œé…ç½®ä»¥ä¸‹å†…å®¹ï¼š
- æ•°æ®åº“è¿æ¥ä¿¡æ¯
- JWT å¯†é’¥
- OSS é…ç½®ï¼ˆå¦‚ä½¿ç”¨ï¼‰
- API å¯†é’¥ï¼ˆå¦‚ä½¿ç”¨ï¼‰

### 4. åˆå§‹åŒ–æ•°æ®åº“

```bash
# åˆ›å»ºæ•°æ®åº“
createdb langgraph_db
createdb chat_history_db

# è¿è¡Œåº”ç”¨ä¼šè‡ªåŠ¨åˆ›å»ºè¡¨ç»“æ„
```

### 5. å¯åŠ¨æœåŠ¡

```bash
cd ustc
python web_memory.py
```

## é…ç½®è¯´æ˜

### æ•°æ®åº“é…ç½®

é¡¹ç›®éœ€è¦ä¸¤ä¸ª PostgreSQL æ•°æ®åº“ï¼š
- `langgraph_db`: ç”¨äº LangGraph çŠ¶æ€å­˜å‚¨
- `chat_history_db`: ç”¨äºå¯¹è¯å†å²å­˜å‚¨

### è®¤è¯é…ç½®

æ”¯æŒä¸‰ç§è®¤è¯æ–¹å¼ï¼š
1. **ç”¨æˆ·åå¯†ç ç™»å½•**: é»˜è®¤æ–¹å¼
2. **USTC OAuth**: éœ€è¦é…ç½® `USTC_CLIENT_ID` å’Œ `USTC_CLIENT_SECRET`
3. **NSRL CAS**: éœ€è¦é…ç½® CAS æœåŠ¡å™¨åœ°å€

### è§’è‰²æƒé™

- **user**: æ™®é€šç”¨æˆ·ï¼Œåªèƒ½è¿›è¡Œå¯¹è¯
- **contributor**: çŸ¥è¯†åº“è´¡çŒ®è€…ï¼Œå¯ä»¥ä¸Šä¼ æ–‡æ¡£å’Œå¯¹è¯
- **admin**: ç®¡ç†å‘˜ï¼Œå¯ä»¥ç®¡ç†ç”¨æˆ·è§’è‰²å’Œæ‰€æœ‰åŠŸèƒ½

## å¼€å‘è¯´æ˜

### æ·»åŠ æ–°çš„ API ç«¯ç‚¹

```python
from auth import get_current_user

@app.get("/api/your-endpoint")
async def your_endpoint(current_user: UserResponse = Depends(get_current_user)):
    return {"message": f"Hello {current_user.username}!"}
```

### æ·»åŠ çŸ¥è¯†åº“è´¡çŒ®è€…æƒé™

```python
from auth import get_current_contributor_user

@app.post("/api/upload")
async def upload_file(current_user: UserResponse = Depends(get_current_contributor_user)):
    # åªæœ‰ contributor å’Œ admin å¯ä»¥è®¿é—®
    pass
```

## å®‰å…¨æ³¨æ„äº‹é¡¹

âš ï¸ **é‡è¦**: åœ¨ä¸Šä¼ åˆ° GitHub ä¹‹å‰ï¼Œè¯·ç¡®ä¿ï¼š

1. âœ… å·²åˆ›å»º `.gitignore` æ–‡ä»¶
2. âœ… å·²ç§»é™¤æ‰€æœ‰ç¡¬ç¼–ç çš„å¯†é’¥å’Œå¯†ç 
3. âœ… å·²åˆ›å»º `.env.example` ä½œä¸ºé…ç½®æ¨¡æ¿
4. âœ… å·²æ£€æŸ¥æ‰€æœ‰é…ç½®æ–‡ä»¶ä¸åŒ…å«æ•æ„Ÿä¿¡æ¯
5. âœ… æ—¥å¿—æ–‡ä»¶ä¸åŒ…å«æ•æ„Ÿæ•°æ®

## è®¸å¯è¯

[è¯·æ·»åŠ æ‚¨çš„è®¸å¯è¯ä¿¡æ¯]

## è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## è”ç³»æ–¹å¼

[è¯·æ·»åŠ æ‚¨çš„è”ç³»æ–¹å¼]

